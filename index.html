<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Book</title><link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        :root { --primary: #008BFF; }
        body { font-family: sans-serif; margin: 0; background: #1a1a1a; color: white; overflow: hidden; touch-action: none; }
        
        /* Top Navigation Bar */
        .top-nav { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.85); padding: 10px 0; display: flex; justify-content: space-around; align-items: center; z-index: 1000; border-bottom: 1px solid #333; }
        .page-box { width: 50px; padding: 5px; border-radius: 4px; border: 1px solid var(--primary); background: #222; color: white; text-align: center; }
        .go-btn { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 4px; font-weight: bold; }
        
        /* Home Screen */
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f8f9fa; color: #333; z-index: 500; position: relative; }
        .main-btn { background: var(--primary); color: white; padding: 20px 50px; border-radius: 50px; font-size: 22px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; }

        /* PDF Viewer Container */
        #reader-mode { display: none; position: fixed; inset: 0; background: #222; overflow: hidden; }
        #canvas-wrapper { height: 100vh; width: 100vw; display: flex; align-items: center; justify-content: center; overflow: auto; }
        canvas { max-width: 100%; max-height: 90vh; box-shadow: 0 0 30px rgba(0,0,0,0.7); background: white; }

        /* Floating Menu on Tap */
        #menu { display: none; position: fixed; background: white; color: black; border-radius: 12px; padding: 8px; z-index: 2000; min-width: 180px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .menu-item { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body>

<audio id="flipSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>

<div id="home-screen">
    <img src="icon.png" style="width: 100px; border-radius: 20px; margin-bottom: 20px;">
    <button class="main-btn" onclick="document.getElementById('pdf-file').click()">GO TO PDF</button>
    <input type="file" id="pdf-file" accept=".pdf" style="display:none" onchange="initPDF(event)">
    <p style="margin-top:15px; font-size:14px; color:#777;">Apni kitab chunein aur padhna shuru karein</p>
</div>

<div id="reader-mode">
    <div class="top-nav">
        <span style="font-size:14px;">üìÑ <span id="current">1</span> / <span id="total">0</span></span>
        <div>
            <input type="number" id="jumpInput" class="page-box" placeholder="No.">
            <button class="go-btn" onclick="jumpToPage()">GO</button>
        </div>
        <button onclick="location.reload()" style="background:#ff4444; color:white; border:none; padding:6px 12px; border-radius:4px;">CLOSE</button>
    </div>

    <div id="canvas-wrapper">
        <canvas id="pdf-render"></canvas>
    </div>
</div>

<div id="menu">
    <div class="menu-item" onclick="alert('Gemini AI is generating smart notes...')">‚ú® Gemini AI Notes</div>
    <div class="menu-item" onclick="alert('Full Page Content Copied!')">üìÑ Full Page Copy</div>
    <div class="menu-item" onclick="alert('Manual selection mode activated')">üñêÔ∏è Manual Selection</div>
</div>

<script>
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    let pdfDoc = null, pageNum = 1, rendering = false;
    let startX = 0;

    async function initPDF(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = async function() {
            const data = new Uint8Array(this.result);
            try {
                pdfDoc = await pdfjsLib.getDocument(data).promise;
                document.getElementById('total').textContent = pdfDoc.numPages;
                document.getElementById('home-screen').style.display = 'none';
                document.getElementById('reader-mode').style.display = 'block';
                renderPage(pageNum);
            } catch (err) {
                alert("PDF load karne mein galti: " + err.message);
            }
        };
        reader.readAsArrayBuffer(file);
    }

    async function renderPage(num) {
        rendering = true;
        const page = await pdfDoc.getPage(num);
        const canvas = document.getElementById('pdf-render');
        const ctx = canvas.getContext('2d');
        const viewport = page.getViewport({ scale: 1.5 });

        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: ctx, viewport: viewport }).promise;
        rendering = false;
        document.getElementById('current').textContent = num;
    }

    // Swipe Feature (Left/Right)
    const viewer = document.getElementById('reader-mode');
    viewer.addEventListener('touchstart', e => { startX = e.touches[0].clientX; }, false);
    viewer.addEventListener('touchend', e => {
        let endX = e.changedTouches[0].clientX;
        if (startX - endX > 50) movePage('next'); // Swipe Left -> Next
        else if (endX - startX > 50) movePage('prev'); // Swipe Right -> Prev
    }, false);

    function movePage(dir) {
        if (!pdfDoc || rendering) return;
        if (dir === 'next' && pageNum < pdfDoc.numPages) {
            pageNum++; playFlip(); renderPage(pageNum);
        } else if (dir === 'prev' && pageNum > 1) {
            pageNum--; playFlip(); renderPage(pageNum);
        }
    }

    function jumpToPage() {
        const val = parseInt(document.getElementById('jumpInput').value);
        if (val > 0 && val <= pdfDoc.numPages) {
            pageNum = val; playFlip(); renderPage(pageNum);
        } else {
            alert("Sahi page number daalein (1 se " + pdfDoc.numPages + ")");
        }
    }

    function playFlip() {
        const s = document.getElementById('flipSound');
        s.currentTime = 0;
        s.play().catch(() => {}); // Play only if user interacted
    }

    // Tap for Menu
    document.getElementById('canvas-wrapper').addEventListener('click', (e) => {
        const menu = document.getElementById('menu');
        menu.style.display = 'block';
        menu.style.left = Math.min(e.clientX, window.innerWidth - 200) + 'px';
        menu.style.top = Math.min(e.clientY, window.innerHeight - 200) + 'px';
    });

    // Hide Menu on click outside
    window.onclick = (e) => {
        if (!e.target.closest('#canvas-wrapper') && !e.target.closest('#menu')) {
            document.getElementById('menu').style.display = 'none';
        }
    };
</script>
</body>
</html>

