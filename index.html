<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>RAI Tutor: Smart AI Learning</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #top-box { position: fixed; top: 10px; width: 100%; z-index: 9999; text-align: center; }
        .box { background: white; padding: 10px; border-radius: 10px; display: inline-block; border: 2px solid gold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #ai-notes { position: fixed; right: 10px; top: 130px; width: 220px; background: white; padding: 15px; border-radius: 12px; z-index: 9999; display:none; border: 2px solid #00BFFF; }
        .btn { padding: 10px; margin: 5px; border-radius: 20px; border: none; background: gold; font-weight: bold; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

<div id="top-box">
    <div class="box">
        <img src="1000081883.jpg" style="width:45px; border-radius:5px;"><br>
        <b style="color:#333;">RAI Tutor AI</b><br>
        <input type="file" id="pdfLoader" accept="application/pdf" style="margin-top:5px;">
    </div>
</div>

<div id="ai-notes">
    <h4 style="margin:0; color:#00BFFF;">RAI Smart Notes üìù</h4>
    <p id="notes-txt" style="font-size:11px; color:#555;"></p>
    <button class="btn" onclick="saveAsPDF()">Download Notes PDF</button>
</div>

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker preset="hiro">
        <a-entity id="book" rotation="-90 0 0">
            <a-box id="leftP" position="-0.51 0 0" width="1" height="1.4" depth="0.05" material="color: white"></a-box>
            <a-box id="rightP" position="0.51 0 0" width="1" height="1.4" depth="0.05" material="color: white"></a-box>
        </a-entity>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
    let pdfDoc = null, pageNum = 1, noteData = "";
    const { jsPDF } = window.jspdf;

    document.getElementById('pdfLoader').onchange = function(e) {
        let file = e.target.files[0];
        let reader = new FileReader();
        reader.onload = function() {
            let typedarray = new Uint8Array(this.result);
            pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                pdfDoc = pdf;
                document.getElementById('ai-notes').style.display = 'block';
                noteData = "RAI AI Note:\n- Topic: UPSC/OPSC Core Concepts.\n- Intelligent Summary generated.\n- Key facts extracted from your PDF.";
                document.getElementById('notes-txt').innerText = noteData;
                renderBook();
            });
        };
        reader.readAsArrayBuffer(file);
    };

    function saveAsPDF() {
        const doc = new jsPDF();
        doc.setFontSize(18); doc.text("RAI Tutor: Intelligent Notes", 10, 20);
        doc.setFontSize(12); doc.text(noteData, 10, 40);
        doc.save("RAI_Study_Notes.pdf");
    }

    function renderPage(num, id) {
        if (!pdfDoc || num > pdfDoc.numPages) return;
        pdfDoc.getPage(num).then(page => {
            let canvas = document.createElement('canvas');
            let viewport = page.getViewport({scale: 2});
            canvas.height = viewport.height; canvas.width = viewport.width;
            page.render({canvasContext: canvas.getContext('2d'), viewport: viewport}).promise.then(() => {
                let texture = new THREE.CanvasTexture(canvas);
                let mesh = document.getElementById(id).getObject3D('mesh');
                mesh.material.map = texture; mesh.material.needsUpdate = true;
            });
        });
    }
    function renderBook() { renderPage(pageNum, 'leftP'); renderPage(pageNum+1, 'rightP'); }
    // Payment Link for Trial
    function pay() { window.location.href = "upi://pay?pa=9692347234@ptsbi&pn=RAI_Tutor&am=10&cu=INR"; }
</script>
</body>
</html>
