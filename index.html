<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Book</title>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
    <style>
        :root { --primary: #008BFF; }
        body { font-family: sans-serif; margin: 0; background: #2c2c2c; color: white; overflow: hidden; }
        header { background: var(--primary); padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 90vh; background: #f4f4f4; color: black; }
        #reader-mode { display: none; position: fixed; inset: 0; background: #333; z-index: 200; }
        
        /* Page Jumper Style */
        .top-bar { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 10px; display: flex; justify-content: space-around; align-items: center; z-index: 205; }
        .jump-input { width: 60px; padding: 5px; border-radius: 5px; border: none; text-align: center; }
        
        /* Reader Canvas */
        #canvas-wrapper { height: 100vh; display: flex; align-items: center; justify-content: center; touch-action: none; }
        canvas { max-width: 100%; max-height: 85vh; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        /* Floating Menu */
        #floating-options { display: none; position: fixed; background: white; color: black; border-radius: 12px; padding: 10px; z-index: 300; min-width: 160px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .opt-btn { display: block; width: 100%; padding: 10px; border: none; background: none; text-align: left; border-bottom: 1px solid #eee; cursor: pointer; }
    </style>
</head>
<body>

<audio id="pageSound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>

<div id="home-screen">
    <button onclick="document.getElementById('fileInput').click()" style="background:var(--primary); color:white; padding:20px 40px; border-radius:50px; border:none; font-size:20px;">GO TO PDF</button>
    <input type="file" id="fileInput" accept="application/pdf" style="display:none" onchange="handleFile(event)">
</div>

<div id="reader-mode">
    <div class="top-bar">
        <span>Pg: <span id="cur_pg">1</span> / <span id="tot_pg">0</span></span>
        <div>
            <input type="number" id="jump_num" class="jump-input" placeholder="No.">
            <button onclick="jumpToPage()" style="background:var(--primary); color:white; border:none; padding:5px; border-radius:5px;">Go</button>
        </div>
        <button onclick="location.reload()" style="background:red; color:white; border:none; padding:5px 10px; border-radius:5px;">Close</button>
    </div>

    <div id="canvas-wrapper">
        <canvas id="pdf-render"></canvas>
    </div>
</div>

<div id="floating-options">
    <button class="opt-btn" onclick="alert('Gemini AI creating notes...')">‚ú® Gemini AI Notes</button>
    <button class="opt-btn" onclick="alert('Full Page Copied')">üìÑ Full Page Copy</button>
    <button class="opt-btn" onclick="alert('Manual Copy ON')">üñêÔ∏è Manual Copy</button>
</div>

<script>
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.worker.min.js';

    let pdfDoc = null, pageNum = 1, isRendering = false;
    let touchStartX = 0, touchEndX = 0;

    function handleFile(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function() {
                const data = new Uint8Array(this.result);
                pdfjsLib.getDocument(data).promise.then(pdf => {
                    pdfDoc = pdf;
                    document.getElementById('tot_pg').textContent = pdf.numPages;
                    document.getElementById('home-screen').style.display = 'none';
                    document.getElementById('reader-mode').style.display = 'block';
                    renderPage(pageNum);
                });
            };
            reader.readAsArrayBuffer(file);
        }
    }

    function renderPage(num) {
        isRendering = true;
        pdfDoc.getPage(num).then(page => {
            const canvas = document.getElementById('pdf-render');
            const ctx = canvas.getContext('2d');
            const viewport = page.getViewport({scale: 1.5});
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            page.render({canvasContext: ctx, viewport: viewport}).promise.then(() => {
                isRendering = false;
                document.getElementById('cur_pg').textContent = num;
            });
        });
    }

    // Swipe Detection Logic
    const wrapper = document.getElementById('canvas-wrapper');
    wrapper.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
    wrapper.addEventListener('touchend', e => { 
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    });

    function handleSwipe() {
        if (touchEndX < touchStartX - 50) changePage('next'); // Swipe Left -> Next
        if (touchEndX > touchStartX + 50) changePage('prev'); // Swipe Right -> Prev
    }

    function changePage(dir) {
        if (!pdfDoc || isRendering) return;
        if (dir === 'next' && pageNum < pdfDoc.numPages) {
            pageNum++; playSound(); renderPage(pageNum);
        } else if (dir === 'prev' && pageNum > 1) {
            pageNum--; playSound(); renderPage(pageNum);
        }
    }

    function jumpToPage() {
        const val = parseInt(document.getElementById('jump_num').value);
        if (val > 0 && val <= pdfDoc.numPages) {
            pageNum = val; playSound(); renderPage(pageNum);
        }
    }

    function playSound() {
        const sound = document.getElementById('pageSound');
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Sound error: ", e));
    }

    // Tap for options
    wrapper.addEventListener('click', e => {
        const menu = document.getElementById('floating-options');
        menu.style.display = 'block';
        menu.style.left = Math.min(e.clientX, window.innerWidth - 170) + 'px';
        menu.style.top = Math.min(e.clientY, window.innerHeight - 200) + 'px';
    });

    window.onclick = e => {
        if (!e.target.closest('#canvas-wrapper') && !e.target.closest('#floating-options')) {
            document.getElementById('floating-options').style.display = 'none';
        }
    }
</script>
</body>
</html>
