<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Book</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.min.js"></script>
    <style>
        :root { --primary: #008BFF; }
        body { font-family: sans-serif; margin: 0; background: #2c2c2c; color: white; overflow-x: hidden; }
        header { background: var(--primary); padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80vh; background: #f4f4f4; color: black; }
        .go-pdf-btn { background: var(--primary); color: white; padding: 20px 40px; border-radius: 50px; font-size: 20px; border: none; cursor: pointer; font-weight: bold; }
        #reader-mode { display: none; position: fixed; inset: 0; background: #333; z-index: 200; overflow-y: auto; text-align: center; }
        #canvas-wrapper { display: inline-block; margin: 60px 0; position: relative; }
        canvas { max-width: 95vw; height: auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); background: white; }
        #floating-options { display: none; position: fixed; background: white; color: black; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.4); padding: 10px; z-index: 300; min-width: 180px; }
        .opt-btn { display: block; width: 100%; padding: 12px; border: none; background: none; text-align: left; cursor: pointer; border-bottom: 1px solid #eee; font-size: 14px; }
        .page-nav { display: flex; justify-content: space-between; background: #e3f2fd; border-radius: 8px; margin-bottom: 5px; }
        .nav-btn { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 5px; flex: 1; margin: 2px; }
    </style>
</head>
<body>

<audio id="pageSound" src="https://www.soundjay.com/misc/sounds/page-flip-01a.mp3" preload="auto"></audio>

<header>
    <div onclick="alert('Live Users: 1.2k')">‚ò∞</div>
    <div>AR Book</div>
    <div style="font-size: 12px;">Active: 1.2k</div>
</header>

<div id="home-screen">
    <button class="go-pdf-btn" onclick="document.getElementById('fileInput').click()">GO TO PDF</button>
    <input type="file" id="fileInput" accept="application/pdf" style="display:none" onchange="handleFile(event)">
    <p>Apni book select karke padhna shuru karein</p>
</div>

<div id="reader-mode">
    <div style="position:fixed; top:0; width:100%; background:rgba(0,0,0,0.8); padding:10px; display:flex; justify-content:space-between; z-index:205;">
        <span>Page: <span id="cur_pg">1</span> / <span id="tot_pg">0</span></span>
        <button onclick="location.reload()" style="background:red; color:white; border:none; border-radius:5px; padding:5px 10px;">Close ‚úñ</button>
    </div>
    <div id="canvas-wrapper" onclick="showOptions(event)">
        <canvas id="pdf-render"></canvas>
    </div>
</div>

<div id="floating-options">
    <div class="page-nav">
        <button class="nav-btn" onclick="changePage('prev')">‚¨Ö Prev</button>
        <button class="nav-btn" onclick="changePage('next')">Next ‚û°</button>
    </div>
    <button class="opt-btn" onclick="alert('Gemini AI is creating notes...')">‚ú® Make Notes (Gemini)</button>
    <button class="opt-btn" onclick="alert('Copied 2 Pages!')">üìÑ Full Page Copy</button>
    <button class="opt-btn" onclick="alert('Manual Mode ON')">üñêÔ∏è Manual Copy</button>
</div>

<script>
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@2.16.105/build/pdf.worker.min.js';

    let pdfDoc = null, pageNum = 1, isRendering = false;
    const canvas = document.getElementById('pdf-render');
    const ctx = canvas.getContext('2d');

    function handleFile(e) {
        const file = e.target.files[0];
        if (file && file.type === "application/pdf") {
            const reader = new FileReader();
            reader.onload = function() {
                const data = new Uint8Array(this.result);
                pdfjsLib.getDocument(data).promise.then(pdf => {
                    pdfDoc = pdf;
                    document.getElementById('tot_pg').textContent = pdf.numPages;
                    document.getElementById('home-screen').style.display = 'none';
                    document.getElementById('reader-mode').style.display = 'block';
                    renderPage(pageNum);
                });
            };
            reader.readAsArrayBuffer(file);
        }
    }

    function renderPage(num) {
        isRendering = true;
        pdfDoc.getPage(num).then(page => {
            const viewport = page.getViewport({scale: 1.5});
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderCtx = { canvasContext: ctx, viewport: viewport };
            page.render(renderCtx).promise.then(() => {
                isRendering = false;
                document.getElementById('cur_pg').textContent = num;
            });
        });
    }

    function changePage(dir) {
        if (!pdfDoc || isRendering) return;
        if (dir === 'next' && pageNum < pdfDoc.numPages) {
            pageNum++; playSound(); renderPage(pageNum);
        } else if (dir === 'prev' && pageNum > 1) {
            pageNum--; playSound(); renderPage(pageNum);
        }
        document.getElementById('floating-options').style.display = 'none';
    }

    function playSound() {
        const sound = document.getElementById('pageSound');
        sound.currentTime = 0; sound.play();
    }

    function showOptions(e) {
        const menu = document.getElementById('floating-options');
        menu.style.display = 'block';
        menu.style.left = Math.min(e.clientX, window.innerWidth - 200) + 'px';
        menu.style.top = Math.min(e.clientY, window.innerHeight - 250) + 'px';
    }

    window.onclick = function(e) {
        if (!e.target.closest('#canvas-wrapper') && !e.target.closest('#floating-options')) {
            document.getElementById('floating-options').style.display = 'none';
        }
    }
</script>
</body>
</html>
