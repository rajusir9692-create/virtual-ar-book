<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Book</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <style>
        :root { --primary: #008BFF; }
        body { font-family: sans-serif; margin: 0; background: #f4f4f4; overflow-x: hidden; }
        
        /* Header & Sidebar */
        header { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        #sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: white; z-index: 999; transition: 0.3s; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        #sidebar.active { left: 0; }
        
        /* Central Button */
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 80vh; }
        .go-pdf-btn { background: var(--primary); color: white; padding: 20px 40px; border-radius: 50px; font-size: 20px; border: none; cursor: pointer; }

        /* Reader Mode */
        #reader-mode { display: none; background: #525659; height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; z-index: 200; overflow: auto; }
        #pdf-canvas-area { display: flex; flex-direction: column; align-items: center; padding: 20px; cursor: pointer; }
        canvas { max-width: 100%; box-shadow: 0 4px 15px rgba(0,0,0,0.5); margin-bottom: 20px; }

        /* Floating Menu */
        #floating-options { display: none; position: fixed; background: white; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.4); padding: 10px; z-index: 300; min-width: 180px; }
        .opt-btn { display: block; width: 100%; padding: 12px; border: none; background: none; text-align: left; cursor: pointer; border-bottom: 1px solid #eee; }
        .page-nav { display: flex; justify-content: space-between; background: #f0f8ff; border-radius: 8px; margin-bottom: 5px; }
        .nav-btn { background: var(--primary); color: white; border: none; padding: 10px; border-radius: 5px; flex: 1; margin: 2px; }
    </style>
</head>
<body>

<audio id="pageSound" src="https://www.soundjay.com/misc/sounds/page-flip-01a.mp3" preload="auto"></audio>

<header>
    <div onclick="document.getElementById('sidebar').classList.toggle('active')">‚ò∞</div>
    <div>AR Book</div>
    <div style="font-size: 12px;">Live Users: 1.2k</div>
</header>

<div id="sidebar">
    <div style="padding:20px; background:#eef7ff; text-align:center;">
        <img src="icon.png" style="width:80px; border-radius:50%; border: 2px solid var(--primary);">
        <h3>AR Book</h3>
    </div>
    <div style="padding:20px;">
        <div onclick="alert('UPI ID: santu@upi')">üí≥ Payment & Subscription</div>
        <div onclick="location.reload()" style="margin-top:20px; color:red;">Logout / Refresh</div>
    </div>
</div>

<div id="home-screen">
    <button class="go-pdf-btn" onclick="document.getElementById('fileInput').click()">GO TO PDF</button>
    <input type="file" id="fileInput" accept="application/pdf" style="display:none" onchange="handleFile(event)">
</div>

<div id="reader-mode">
    <div style="padding:10px; background:#333; color:white; display:flex; justify-content:space-between; position: sticky; top:0; z-index:201;">
        <span>Page: <span id="page_num">0</span> / <span id="page_count">0</span></span>
        <button onclick="closeReader()" style="background:red; color:white; border:none; padding:5px 10px; border-radius:5px;">Close ‚úñ</button>
    </div>
    <div id="pdf-canvas-area" onclick="showOptions(event)">
        </div>
</div>

<div id="floating-options">
    <div class="page-nav">
        <button class="nav-btn" onclick="changePage('prev')">‚¨Ö Prev</button>
        <button class="nav-btn" onclick="changePage('next')">Next ‚û°</button>
    </div>
    <button class="opt-btn" onclick="alert('Gemini AI processing notes...')">‚ú® Make Notes (Gemini)</button>
    <button class="opt-btn" onclick="alert('Page Copied!')">üìÑ Full Page Copy</button>
    <button class="opt-btn" onclick="markPage()">üìç Mark Page</button>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    let pdfDoc = null, pageNum = 1, isRendering = false;

    function handleFile(e) {
        const file = e.target.files[0];
        if (file && file.type === "application/pdf") {
            const reader = new FileReader();
            reader.onload = function() {
                const data = new Uint8Array(this.result);
                pdfjsLib.getDocument(data).promise.then(pdf => {
                    pdfDoc = pdf;
                    document.getElementById('page_count').textContent = pdf.numPages;
                    renderPage(pageNum);
                    document.getElementById('reader-mode').style.display = 'block';
                });
            };
            reader.readAsArrayBuffer(file);
        }
    }

    function renderPage(num) {
        isRendering = true;
        pdfDoc.getPage(num).then(page => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const viewport = page.getViewport({scale: 1.5});
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderContext = { canvasContext: ctx, viewport: viewport };
            page.render(renderContext).promise.then(() => {
                isRendering = false;
                const area = document.getElementById('pdf-canvas-area');
                area.innerHTML = ''; 
                area.appendChild(canvas);
                document.getElementById('page_num').textContent = num;
            });
        });
    }

    function changePage(dir) {
        if (!pdfDoc || isRendering) return;
        if (dir === 'next' && pageNum < pdfDoc.numPages) {
            pageNum++; playSound(); renderPage(pageNum);
        } else if (dir === 'prev' && pageNum > 1) {
            pageNum--; playSound(); renderPage(pageNum);
        }
        document.getElementById('floating-options').style.display = 'none';
    }

    function playSound() {
        const sound = document.getElementById('pageSound');
        sound.currentTime = 0; sound.play();
    }

    function showOptions(e) {
        const menu = document.getElementById('floating-options');
        menu.style.display = 'block';
        menu.style.left = Math.min(e.pageX, window.innerWidth - 200) + 'px';
        menu.style.top = Math.min(e.pageY, window.innerHeight - 250) + 'px';
    }

    function closeReader() { document.getElementById('reader-mode').style.display = 'none'; }

    window.onclick = function(event) {
        if (!event.target.closest('#pdf-canvas-area') && !event.target.closest('#floating-options')) {
            document.getElementById('floating-options').style.display = 'none';
        }
    }
</script>
</body>
</html>
